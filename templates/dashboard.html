<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h2>
                <img src="{{ url_for('static', filename='svg/file.svg') }}" alt="File Icon" class="icon-sm">
                Dashboard
            </h2>
            <div class="button-group">
                <a href="/profile" class="profile-link">Profile</a>
                <button id="theme-toggle" class="theme-toggle">üåô Dark Mode</button>
                <a href="/logout" class="logout-btn">Logout</a>
            </div>
        </div>

        <h3>Welcome, {{ username }}</h3>

        <form method="POST" enctype="multipart/form-data" class="upload-form" onsubmit="showLoader()">
            <input type="file" name="file" required>
            <select name="algorithm" required>
                <option value="zip">ZIP</option>
                <option value="huffman">Huffman</option>
            </select>
            <button type="submit" id="submit-btn">Compress File</button>

            <div id="loader" class="loader" style="display: none;">
                <img src="{{ url_for('static', filename='svg/loading.svg') }}" alt="Loading..." class="spinner">
                Compressing...
            </div>

            <div id="progress-container" class="progress-container" style="display: none;">
                <div class="progress-bar" id="progress-bar"></div>
                <span id="progress-text">0%</span>
            </div>
        </form>

        <div class="history-title">
            <img src="{{ url_for('static', filename='svg/compress.svg') }}" alt="Compress Icon" class="icon-sm">
            Compression History
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Filename</th>
                        <th>Original Size</th>
                        <th>Compressed Size</th>
                        <th>Ratio</th>
                        <th>Duration</th>
                        <th>Timestamp</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in history %}
                    <tr>
                        <td>{{ item[1] }}</td>
                        <td>{{ item[2] }} B</td>
                        <td>{{ item[3] }} B</td>
                        <td>{{ item[4] }}</td>
                        <td>{{ item[7] }}</td>
                        <td>{{ item[6] }}</td>
                        <td>
                            <a href="{{ url_for('download_file', filename=item[5]) }}" class="download-btn">
                                <img src="{{ url_for('static', filename='svg/download.svg') }}" alt="Download Icon" class="icon-xs">
                                Download
                            </a>
                            <form action="{{ url_for('delete_file', file_id=item[0]) }}" method="POST" style="display:inline;">
                                <button type="submit" class="delete-btn" onclick="return confirm('Delete this file from history?');">
                                    üóëÔ∏è Delete
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const toggle = document.getElementById('theme-toggle');
        const body = document.body;

        toggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            toggle.textContent = body.classList.contains('dark-mode') ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        });

        function showLoader() {
            const loader = document.getElementById('loader');
            const submitBtn = document.getElementById('submit-btn');
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');

            loader.style.display = 'block';
            progressContainer.style.display = 'block';
            submitBtn.disabled = true;

            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.floor(Math.random() * 10) + 5;
                if (progress > 100) progress = 100;

                progressBar.style.width = progress + '%';
                progressText.textContent = progress + '%';

                if (progress === 100) {
                    clearInterval(interval);
                }
            }, 300);
        }
    </script>
</body>
</html>
